<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EDS 217: Python for Environmental Data Science - Interactive Session 0-1: Getting ready to Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles/activities.css">
</head>

<body class="floating">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#general-plan" id="toc-general-plan" class="nav-link active" data-scroll-target="#general-plan">General Plan</a></li>
  <li><a href="#managing-computing-environments-libraries-and-dependencies" id="toc-managing-computing-environments-libraries-and-dependencies" class="nav-link" data-scroll-target="#managing-computing-environments-libraries-and-dependencies">Managing Computing Environments, Libraries, and Dependencies</a>
  <ul class="collapse">
  <li><a href="#tools-that-manage-both-environments-and-packages" id="toc-tools-that-manage-both-environments-and-packages" class="nav-link" data-scroll-target="#tools-that-manage-both-environments-and-packages">Tools that manage both environments and packages</a></li>
  </ul></li>
  <li><a href="#cloning-the-course-repository" id="toc-cloning-the-course-repository" class="nav-link" data-scroll-target="#cloning-the-course-repository">0. Cloning the course repository</a></li>
  <li><a href="#installing-and-configuring-conda" id="toc-installing-and-configuring-conda" class="nav-link" data-scroll-target="#installing-and-configuring-conda">1. Installing and configuring <code>conda</code></a>
  <ul class="collapse">
  <li><a href="#instructions-installing-configuring-conda" id="toc-instructions-installing-configuring-conda" class="nav-link" data-scroll-target="#instructions-installing-configuring-conda">Instructions: Installing &amp; configuring conda</a></li>
  </ul></li>
  <li><a href="#managing-code-and-execution-ides" id="toc-managing-code-and-execution-ides" class="nav-link" data-scroll-target="#managing-code-and-execution-ides">Managing code and execution (IDEs)</a></li>
  <li><a href="#launching-jupyter-notebooks-and-testing-your-environment" id="toc-launching-jupyter-notebooks-and-testing-your-environment" class="nav-link" data-scroll-target="#launching-jupyter-notebooks-and-testing-your-environment">2. Launching Jupyter Notebooks and Testing your Environment</a>
  <ul class="collapse">
  <li><a href="#instruction-launching-jupyter-and-testing-your-environment" id="toc-instruction-launching-jupyter-and-testing-your-environment" class="nav-link" data-scroll-target="#instruction-launching-jupyter-and-testing-your-environment">Instruction: Launching Jupyter and testing your environment</a></li>
  </ul></li>
  <li><a href="#installing-and-configuring-vscode-for-python" id="toc-installing-and-configuring-vscode-for-python" class="nav-link" data-scroll-target="#installing-and-configuring-vscode-for-python">3. Installing and Configuring VSCode for Python</a>
  <ul class="collapse">
  <li><a href="#instructions-installing-and-confuguring-vscode" id="toc-instructions-installing-and-confuguring-vscode" class="nav-link" data-scroll-target="#instructions-installing-and-confuguring-vscode">Instructions: Installing and confuguring VSCode</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<hr>
<h4 class="anchored"> <a href="../">Return to Course Home Page</a></h4>
<hr>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Interactive Session 0-1: Getting ready to Python</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><a href="../index.html">üè† Course Home</a> | <a href="../interactive_sessions/0-2_hello_data_science.html">‚û°Ô∏è Next Session</a> |</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/python_environment_2x.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Python Comic</figcaption>
</figure>
</div>
<section id="general-plan" class="level2">
<h2 class="anchored" data-anchor-id="general-plan">General Plan</h2>
<p>There are many ways to set up your local machine to run maintainable python data science code. In addition to the usual need to build your code using version control (e.g.&nbsp;GitHub), any strategy for local computation requires three critical components:</p>
<ol type="1">
<li>A system for managing computing environments to ensure that code runs in a consistent environment.</li>
<li>A system for managing python packages to ensure that code runs with consistent dependencies.</li>
<li>A system for managing python code, which is usually an integrated development environment (IDE) in which editing and running code occur interactively.</li>
</ol>
<p>In the past, these three components were often managed separately, but in recent years, there has been a trend towards integrating these components into a single system. For example, the <a href="https://rstudio.com">RStudio IDE</a> is a single system that manages all three components for R code. Similarly, the <a href="https://www.jetbrains.com/dataspell/">Data Spell IDE</a> is a single system that manages all three components for python code.</p>
<p>In this class, we will use a combination of tools to manage these three components. We will use <code>conda</code> to manage computing environments and python packages, and we will use <a href="https://code.visualstudio.com">Visual Studio Code</a> as our IDE.</p>
<p>These are both very popular tools in the python data science community, and they are both free and open source. However, there are many other options for managing computing environments, python packages, and code execution. We will discuss some of these options below, or you can skip ahead to the <a href="#instructions">instructions</a> for setting up your local machine.</p>
</section>
<section id="managing-computing-environments-libraries-and-dependencies" class="level2">
<h2 class="anchored" data-anchor-id="managing-computing-environments-libraries-and-dependencies">Managing Computing Environments, Libraries, and Dependencies</h2>
<p>There are many options for managing computing environments. These days, a common method is to use <code>containers</code>, in which an entire computational system (including processes, memory, disk space) is spun up as an isolated service on your local (or remote) machine. Tools such as <a href="https://www.docker.com">docker</a> or python-specific <a href="https://shiv.readthedocs.io/en/latest/">shiv</a> allow for isolated packaging and execution of python programs. Generally, these are better-suited for deployment of code on remote servers, but they can be used locally too. In this class, we‚Äôre not going to use containers. Instead we will use a more traditional approach to managing computing environments and packages.</p>
<p>More traditional approaches to managing computing environments and/or packages and dependencies include a suite of diverse tools. Some of these focus only on managing computing environments, while others focus on managing python packages. Some are designed to work with python only (e.g <code>venv</code>, <code>conda</code>), while others are designed to work with any programming language (e.g <code>virtualenv</code>). A few of the most popular options in each category are listed below.</p>
<section id="package-management-tools-for-python" class="level4">
<h4 class="anchored" data-anchor-id="package-management-tools-for-python">Package management tools for python</h4>
<p><code>pip</code> is the standard package management tool for python. It is included with the standard python distribution, and it is the most widely used package management tool for python. However, it does not manage computing environments, so it is not as widely used as other tools below.</p>
<p><code>pipx</code> is a tool developed by <a href="https://snarky.ca">Brett Cannon</a> that is designed to manage python packages. It has the advantage of being able to install any package hosted on <a href="https://pypi.org">PyPI</a>, as well as packages hosted on github and even packages you‚Äôve made on your local machine. However, it does not manage computing environments, and it does not manage package dependencies.</p>
</section>
<section id="environment-management-tools-for-python" class="level4">
<h4 class="anchored" data-anchor-id="environment-management-tools-for-python">Environment management tools for python</h4>
<p><code>virtualenv</code> is a is a tool to create isolated Python environments. Since Python 3.3, a subset of it has been integrated into the standard library under the <code>venv</code>. While <code>venv</code> is sufficient to create virtual environments, it does not manage package dependencies, so it is also not as widely used as other tools below.</p>
</section>
<section id="tools-that-manage-both-environments-and-packages" class="level3">
<h3 class="anchored" data-anchor-id="tools-that-manage-both-environments-and-packages">Tools that manage both environments and packages</h3>
<p><code>conda</code> is a tool developed by <a href="https://anaconda.org">Anaconda</a> that is designed to manage computing environments. However, it also allows you to install packages, and even install binaries of packages directly without the need for local compilation. It also manages package dependencies, ensuring libraries are inter-operable.</p>
<p><code>mamba</code> is a new tool developed by the <a href="https://quantstack.net">QuantStack</a> team that is designed to be a drop-in replacement for <code>conda</code>. It allows you to create new environments, install packages, and even install binaries of packages directly without the need for local compilation. It also manages package dependencies, ensuring libraries are inter-operable. It is designed to be faster than <code>conda</code> and to use fewer resources. It is also designed to be more compatible with <code>pip</code> than <code>conda</code>. However, it is not as widely used as <code>conda</code> and it is not as well-supported by IDEs.</p>
<p><code>poetry</code> is another new tool developed by the <a href="https://python-poetry.org">Python Packaging Authority</a> team that is designed to manage computing environments and python packages. Advantages of <code>poetry</code> include a simplified approach to dependency management and a simplified approach to building and packaging your own code for distribution. Disadvantages include a lack of support for <code>conda</code> environments and a lack of support for <code>pip</code> packages that are not hosted on <a href="https://pypi.org">PyPI</a> (although this may change in the future).</p>
</section>
</section>
<section id="cloning-the-course-repository" class="level1">
<h1>0. Cloning the course repository</h1>
<p>Before we get started, we need to clone the course repository. This will create a local copy of the course repository on your local machine. We will use this local copy to work through the course materials and you will be able to add your own code to this local copy as you work through the course.</p>
<p>To clone the course repository, you can either go to the <a href="https://github.com/environmental-data-science/eds217_2023">course repository</a> on GitHub and click the green ‚ÄúCode‚Äù button, or you can open a terminal and run the following command:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/environmental-data-science/eds217_2023.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Make sure you put the course repository in a location where you can find it again. For example, you might want to put it in a folder called <code>dev</code> or <code>meds</code> or <code>code</code> or <code>projects</code> or something like that. Hopefully you already have organization from your prior work, but if not, now is a good time to start.</p>
</section>
<section id="installing-and-configuring-conda" class="level1">
<h1>1. Installing and configuring <code>conda</code></h1>
<p>Throughout this course, <strong>we will use <code>conda</code> for our environment management</strong>. We can access <code>conda</code> through the terminal/command line or within a terminal inside an IDE.</p>
<p>Here are detailed instructions for getting conda and our class environment ready for use on your local machine.</p>
<section id="instructions-installing-configuring-conda" class="level2">
<h2 class="anchored" data-anchor-id="instructions-installing-configuring-conda">Instructions: <a href="../interactive_sessions/conda_setup.html">Installing &amp; configuring conda</a></h2>
</section>
</section>
<section id="managing-code-and-execution-ides" class="level1">
<h1>Managing code and execution (IDEs)</h1>
<p>Finally, we come to the tool you will use most when coding on your local computer ‚Äì the Integrated Development Environment, or IDE. The possibilities for IDEs is even more expansive than for either of the other tools. Common python IDEs include:</p>
<ul>
<li><a href="https://code.visualstudio.com">Visual Studio Code</a></li>
<li><a href="https://jupyter.org">Jupyter Notebooks</a></li>
<li><a href="https://jupyter.org">Jupyter Labs</a></li>
<li><a href="https://www.spyder-ide.org">Spyder</a></li>
<li><a href="https://www.jetbrains.com/pycharm/">PyCharm</a></li>
<li><a href="https://www.jetbrains.com/dataspell/">Data Spell</a></li>
<li><a href="https://atom.io">Atom</a></li>
<li><a href="https://www.rstudio.com">RStudio</a></li>
</ul>
<p>Any of these would work well for a python data science workflow, but some have more features focused on data science than others. For example, PyCharm is more focused on software engineering, but a new IDE called Data Spell, by the same company (Jet Brains), is squarely centered on data science workflows.</p>
<p>The best IDE is usually the one you are most familiar with. For that reason, RStudio isn‚Äôt a <em>terrible</em> choice for an IDE. Many data scientists use <code>Jupyter</code> (both Jupyter Notebooks and JupyterLab). However, using a non-browser IDE provides more opportunities for customization and removes a layer of complication required when executing your code.</p>
<section id="python-data-science-editor-usage-primary-editor" class="level4">
<h4 class="anchored" data-anchor-id="python-data-science-editor-usage-primary-editor">Python Data Science Editor Usage (Primary Editor)</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/editor_usage.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">IDE choices</figcaption>
</figure>
</div>
</section>
<section id="python-data-science-editor-usage-secondary-editor" class="level4">
<h4 class="anchored" data-anchor-id="python-data-science-editor-usage-secondary-editor">Python Data Science Editor Usage (Secondary Editor)</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/editor_usage_secondary.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">IDE choices</figcaption>
</figure>
</div>
</section>
</section>
<section id="launching-jupyter-notebooks-and-testing-your-environment" class="level1">
<h1>2. Launching Jupyter Notebooks and Testing your Environment</h1>
<p>Jupyter notebooks are the easiest way to get up-and-running with python. They are also a great tool for formatting code and documentation in the same place. All of the class materials for this course were developed as notebook files. These files aren‚Äôt pure python, and instead are somewhat similar to <code>.Rmd</code> files. However, instead of being encoded in <code>markdown</code>, notebooks are encoded as <code>json</code> files.</p>
<p>The <code>json</code> format is much more extensible than markdown, but also much harder to edit (it‚Äôs closer to raw <code>html</code> or <code>xml</code>). Most python IDEs can render notebook files, but some may support more features than others. To get the most functionality from a notebook (or <code>.ipynb</code>) file, it‚Äôs best to view, edit, and execute the notebook in a <code>Jupyter</code> server. Let‚Äôs start our first server and make sure everything is working well.</p>
<section id="instruction-launching-jupyter-and-testing-your-environment" class="level2">
<h2 class="anchored" data-anchor-id="instruction-launching-jupyter-and-testing-your-environment">Instruction: <a href="../interactive_sessions/jupyter_setup.html">Launching Jupyter and testing your environment</a></h2>
</section>
</section>
<section id="installing-and-configuring-vscode-for-python" class="level1">
<h1>3. Installing and Configuring VSCode for Python</h1>
<p><strong>In this class, we will focus on using Visual Studio Code (VSCode) as our IDE.</strong></p>
<p>This selection provides you with exposure to the single most popular IDE in the datascience world and also one that is well-supported by the <code>conda</code> environment management system. It is also a very popular IDE for software engineering, so you will be able to use it for other courses and projects as well.</p>
<section id="instructions-installing-and-confuguring-vscode" class="level2">
<h2 class="anchored" data-anchor-id="instructions-installing-and-confuguring-vscode">Instructions: <a href="../interactive_sessions/vscode_setup.html">Installing and confuguring VSCode</a></h2>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>